# 要件定義

このドキュメントは `2026-02-20` に作成されました(`747e4d4`)。

## Introduction

グラフのフィールド（何もないところ）を右クリックしてコンテキストメニューからプロジェクトにアイテム（ノード）を追加できる機能。Issue の新規作成、既存 Issue/PR のプロジェクトへの追加ができる。Issue 作成時はリポジトリの Issue テンプレートを選択できる。追加したアイテムは右クリックした位置にノードとして配置される。

## Alignment with Product Vision

product.md の「シンプルな操作」「GitHub ネイティブ」の原則に沿い、グラフ上の操作だけで Issue の作成やアイテムの追加を完結させる。依存関係の設計中に不足しているタスクを発見した際、GitHub のブラウザに切り替えることなく即座に対応できる。

## 機能要件

### コンテキストメニュー

- グラフ上の何もないところ（ノードやエッジ以外の領域）を右クリックすると、コンテキストメニューが表示される
- コンテキストメニューは以下の2グループで構成される
  - **新規作成**: 「Issue を作成」
  - **既存を追加**: 「Issue を追加」「PR を追加」
- メニュー選択時、右サイドパネル（既存の IssueDetail パネルと同じ位置）にフォームが表示される

### Issue の作成

- 右サイドパネルに Issue 作成フォームが表示される
- フォームには以下の入力欄がある
  - リポジトリ選択: プロジェクト内のリポジトリ一覧のドロップダウン + 手動入力（owner/repo）も可能
  - テンプレート選択: 選択したリポジトリの `.github/ISSUE_TEMPLATE/` にあるテンプレートを API で取得し一覧表示する。テンプレートを選択するとタイトルと本文がプリフィルされる
  - タイトル（必須）
  - 本文（任意）
  - Assignees: リポジトリのコラボレーターから選択可能
  - プロジェクトフィールド: 現在のプロジェクトのフィールド（Status, Iteration などの SINGLE_SELECT / ITERATION タイプ）を設定可能
- テンプレートが存在しない場合は、テンプレート選択欄は表示せず空のフォームで作成する
- タイトルを入力して送信すると GitHub REST API で Issue が作成される
- 作成された Issue は自動的に現在のプロジェクトに追加される
- 作成された Issue は右クリックした位置にノードとして配置される
- 作成中にエラーが発生した場合、エラーメッセージを表示し、フォームの入力内容は保持する

### 既存 Issue の追加

- 右サイドパネルに Issue 検索フォームが表示される
- 現在のプロジェクトの owner 配下のリポジトリを対象にキーワード検索できる
- 検索結果から Issue を選択すると、その Issue が現在のプロジェクトに追加される
- 追加された Issue は右クリックした位置にノードとして配置される

### 既存 PR の追加

- 右サイドパネルに PR 検索フォームが表示される
- 現在のプロジェクトの owner 配下のリポジトリを対象にキーワード検索できる
- 検索結果から PR を選択すると、その PR が現在のプロジェクトに追加される
- 追加された PR は右クリックした位置にノードとして配置される

## 非機能要件

### パフォーマンス要件

- Issue 作成・アイテム追加の API 呼び出しは 5 秒以内に完了すること
- Issue テンプレート一覧の取得は、リポジトリ選択時に非同期で行い UI をブロックしないこと
- 作成・追加後のグラフ更新は、キャッシュ無効化 → 再取得で行い、既存のパターンに従う

### セキュリティ要件

- 認証は既存の `gh` CLI の認証情報をそのまま利用する（新規認証フロー不要）
- ユーザー入力（タイトル、本文）は GitHub API にそのまま渡す（GitHub 側でサニタイズ）

### 信頼性要件

- ネットワークエラー時はエラーメッセージを表示し、フォームの入力内容は保持する

### ユーザビリティ要件

- フォーム送信中はローディング状態を表示し、二重送信を防止する
- コンテキストメニューはブラウザのデフォルト右クリックメニューを抑制して表示する
